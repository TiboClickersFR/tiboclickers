<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tibo Clicker</title>
    <style>
        /* CSS pour le style du jeu */
        body {
            /* Simule l'arri√®re-plan de Cookie Clicker (couleur sombre, motif subtil) */
            background-color: #0b0908; 
            color: #f7f7f7;
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            background-image: radial-gradient(circle, #222222 1px, transparent 1px);
            background-size: 15px 15px;
        }

        #game-container {
            display: flex;
            max-width: 1000px;
            margin: 0 auto;
            border: 2px solid #5a5a5a;
            border-radius: 10px;
            background-color: #1a1a1a;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #clicker-area {
            flex: 2;
            padding: 20px;
            border-right: 2px solid #5a5a5a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
        }

        #upgrades-area {
            flex: 1;
            padding: 20px;
            background-color: #2c2c2c;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            position: relative; /* Pour les animations */
            overflow-y: auto; /* Permet le d√©filement si beaucoup d'upgrades */
            /* MODIFICATION ICI : R√©duction de la hauteur maximale du cadre */
            max-height: 60vh; /* Limite la hauteur de la zone d'am√©lioration √† 60% du viewport */
        }

        #score {
            font-size: 2.5em;
            font-weight: bold;
            color: #ffcc00; /* Jaune pour l'or */
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px #000;
        }

        #tibo-image {
            /* Image plus grande */
            width: 350px; 
            height: 350px;
            border-radius: 50%; /* Image ronde pour un meilleur effet de bouton */
            cursor: pointer;
            box-shadow: 0 0 15px #ffcc00, 0 0 30px rgba(255, 204, 0, 0.5);
            transition: transform 0.1s;
            user-select: none; /* Emp√™che la s√©lection du texte/image */
            object-fit: cover;
            /* MISE √Ä JOUR : Utilisation de votre fichier "Tibo.png" */
            background-image: url('Tibo.png'); 
            background-size: cover;
            background-position: center;
            border: 5px solid #ffcc00;
        }

        #tibo-image:active {
            transform: scale(0.95); /* Effet de clic */
        }

        .upgrade-button {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            background-color: #3b3b3b;
            color: #f7f7f7;
            border: 2px solid #5a5a5a;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s, transform 0.1s, opacity 0.5s; /* Ajout d'opacity pour l'animation */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upgrade-button.hidden {
            display: none;
            opacity: 0;
        }

        .upgrade-button:hover:not(:disabled) {
            background-color: #4f4f4f;
            transform: translateY(-2px);
        }

        .upgrade-button:disabled {
            background-color: #222222;
            color: #777;
            cursor: not-allowed;
            border-color: #333;
        }
        
        .upgrade-details {
            text-align: left;
        }
        
        .upgrade-title {
            font-weight: bold;
            color: #ffcc00;
        }

        .upgrade-cost {
            font-weight: bold;
            color: #ffcc00;
            white-space: nowrap; /* Emp√™che le co√ªt de passer √† la ligne */
        }
        
        /* Cible l'√©l√©ment qui affiche le nombre poss√©d√© */
        .upgrade-count {
            display: block;
            font-size: 0.7em;
            color: #aaa;
            margin-top: 5px;
        }

        .floating-text {
            position: absolute;
            font-size: 2em;
            color: #ffcc00;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            animation: floatUp 0.8s ease-out;
            text-shadow: 1px 1px 2px #000;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        h2 {
            color: #ffcc00;
            border-bottom: 2px solid #5a5a5a;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        #click-power-display {
            font-size: 1.2em;
            margin-top: 10px;
            color: #ccc;
        }

        #tps-display {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #ccc;
        }

        /* Styles pour les animations d'apparition des nouvelles am√©liorations */
        .new-upgrade-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .new-upgrade-animation {
            animation: fadeIn 0.8s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Conteneur global pour les contr√¥les au-dessus du jeu */
        #top-controls-container {
            max-width: 1000px; /* Alignement sur la largeur de game-container */
            margin: 0 auto;
            padding: 0 20px; /* Ajout du padding pour aligner sur le bord du jeu */
            display: flex;
            flex-direction: column; 
            align-items: flex-end; /* Garde le s√©lecteur de langue √† droite */
            margin-bottom: 10px;
        }
        
        /* Contr√¥le Musique (Large) */
        #music-control {
            width: 100%; /* Prend toute la largeur de #top-controls-container (1000px) */
            padding: 10px;
            background: #2c2c2c;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Pour √©taler le titre et les boutons */
            gap: 10px;
            font-size: 0.9em;
            margin-bottom: 10px; 
            box-sizing: border-box; /* Assure que le padding est inclus dans la width de 100% */
        }
        #music-control-buttons {
            display: flex;
            gap: 10px;
        }
        #music-control button {
            background: #4f4f4f;
            color: #ffcc00;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            transition: background 0.2s;
        }
        #music-control button:hover {
            background: #6a6a6a;
        }
        
        /* Styles pour le s√©lecteur de langue compact */
        #language-selector-container {
            width: 100%; /* S'aligne √† la musique ci-dessus */
            display: flex;
            justify-content: flex-end; /* Aligne le s√©lecteur √† droite */
            align-items: center;
            gap: 5px;
            font-size: 1.2em; 
            color: #ccc;
        }

        #language-selector {
            padding: 5px;
            border-radius: 5px;
            background-color: #3b3b3b;
            color: #f7f7f7;
            border: 1px solid #5a5a5a;
            cursor: pointer;
            font-size: 0.9em;
            appearance: none; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='white' d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 5px center;
            padding-right: 25px; 
        }
    </style>
</head>
<body>

    <h1 id="main-title">Tibo Clicker - La Vraie Transfo' ! üí™</h1>
    
    <!-- NOUVEAU CONTENEUR GLOBAL POUR LES CONTR√îLES -->
    <div id="top-controls-container">
        <!-- 1. Contr√¥le Musique (Large) -->
        <div id="music-control">
            <p><span id="music-label">Musique</span> : <span id="current-track-title">Musique de Fond Classique</span></p>
            <div id="music-control-buttons">
                 <button onclick="toggleMusic()">‚ñ∂Ô∏è / ‚è∏Ô∏è</button>
                 <button onclick="nextTrack()">‚è≠Ô∏è</button>
            </div>
        </div>

        <!-- 2. S√©lecteur de Langue -->
        <div id="language-selector-container">
            <span id="lang-label">üåê</span>
            <select id="language-selector" onchange="setLanguage(this.value)">
                <option value="fr">Fran√ßais</option>
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>
    </div>


    <!-- üéß √âl√©ment Audio unique pour la lecture de la playlist -->
    <audio id="background-music" preload="auto"></audio>

    <div id="game-container">
        
        <div id="clicker-area">
            
            <div id="score-container">
                <p id="tibos-owned-label">Tibos Poss√©d√©s :</p>
                <div id="score">0</div>
                <div id="click-power-display">Puissance de Clic : 1 Tibo</div>
                <div id="tps-display">Tibos par Seconde (TPS) : 0</div>
            </div>

            <div id="tibo-image"></div>
            <!-- Image de Tibo -->

        </div>

        <div id="upgrades-area">
            <h2 id="upgrades-title">Am√©liorations</h2>

            <!-- Am√©liorations de Clic (Bonus Additif Unique) -->
            <div id="click-multiplier-container" class="new-upgrade-container">
                <!-- Upgrade 1 initiale -->
                <button id="upgrade-click-1" class="upgrade-button" data-cost="100" data-add-bonus="1" data-purchased="false" data-upgrade-key="mindset">
                    <div class="upgrade-details">
                        <span class="upgrade-title">Mise en Place du "Mindset"</span>
                        <br><span class="upgrade-description">Ajoute +1 TPC de base (Achat Unique)</span>
                    </div>
                    <span class="upgrade-cost">100 Tibos</span>
                </button>
                
                <!-- Upgrade 2 -->
                 <button id="upgrade-click-2-new" class="upgrade-button hidden" data-cost="500" data-add-bonus="3" data-purchased="false" data-upgrade-key="ultrasale">
                    <div class="upgrade-details">
                        <span class="upgrade-title">Tibo Ultra Sale üí•</span>
                        <br><span class="upgrade-description">Ajoute +3 TPC de base (Achat Unique)</span>
                    </div>
                    <span class="upgrade-cost">500 Tibos</span>
                </button>
                
                <!-- Upgrade 3 -->
                 <button id="upgrade-click-3-new" class="upgrade-button hidden" data-cost="3000" data-add-bonus="6" data-purchased="false" data-upgrade-key="cheatmeal">
                    <div class="upgrade-details">
                        <span class="upgrade-title">Le Cheat Meal Ultime üçï</span>
                        <br><span class="upgrade-description">Ajoute +6 TPC de base (Achat Unique)</span>
                    </div>
                    <span class="upgrade-cost">3,000 Tibos</span>
                </button>
            </div>
            
            <hr style="border-color: #5a5a5a; margin: 15px 0;">

            <!-- Am√©lioration du Clic (Ajout) - Prix exponentiel -->
            <button id="upgrade-addition" class="upgrade-button" data-base-cost="2000" data-addition="5" data-count="0" data-upgrade-key="proteines">
                <div class="upgrade-details">
                    <span class="upgrade-title">D√©verrouillage des Prot√©ines</span>
                    <br><span class="upgrade-description">Ajoute +5 Tibos par Clic</span>
                    <span class="upgrade-count" id="count-addition">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">2,000 Tibos</span>
            </button>

            <!-- Am√©lioration Passive 1 - Alessio -->
            <button id="upgrade-passive-alessiode" class="upgrade-button" data-base-cost="500" data-tps="1" data-count="0" data-upgrade-key="alessio">
                <div class="upgrade-details">
                    <span class="upgrade-title">Alessiode - Coach Personnel üèãÔ∏è</span>
                    <br><span class="upgrade-description">G√©n√®re 1 Tibo/s</span>
                    <span class="upgrade-count" id="count-passive-alessiode">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">500 Tibos</span>
            </button>
            
            <!-- Am√©lioration Passive 2 - Justine -->
            <button id="upgrade-passive-justine" class="upgrade-button" data-base-cost="5000" data-tps="10" data-count="0" data-upgrade-key="justine">
                <div class="upgrade-details">
                    <span class="upgrade-title">Justine - Community Manager üì∏</span>
                    <br><span class="upgrade-description">G√©n√®re 10 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-justine">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">5,000 Tibos</span>
            </button>
            
            <!-- Am√©lioration Passive 3 - Patate Douce (CHEATEE: 150 TPS) -->
            <button id="upgrade-passive-patate" class="upgrade-button" data-base-cost="40000" data-tps="150" data-count="0" data-upgrade-key="patates">
                <div class="upgrade-details">
                    <span class="upgrade-title">L'Usine √† Patates Douces COSMIQUE üç†üöÄ</span>
                    <br><span class="upgrade-description">G√©n√®re 150 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-patate">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">40,000 Tibos</span>
            </button>

            <!-- NOUVELLE AM√âLIORATION : Nogode -->
            <button id="upgrade-passive-nogode" class="upgrade-button" data-base-cost="200000" data-tps="500" data-count="0" data-upgrade-key="nogode">
                <div class="upgrade-details">
                    <span class="upgrade-title">Nogode - Le Disrupteur Sombre üñ§</span>
                    <br><span class="upgrade-description">G√©n√®re 500 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-nogode">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">200,000 Tibos</span>
            </button>

            <!-- NOUVELLE AM√âLIORATION : Sachatte -->
            <button id="upgrade-passive-sachatte" class="upgrade-button" data-base-cost="1000000" data-tps="2000" data-count="0" data-upgrade-key="sachatte">
                <div class="upgrade-details">
                    <span class="upgrade-title">Sachatte - L'√âclaireuse Mystique ‚ú®</span>
                    <br><span class="upgrade-description">G√©n√®re 2,000 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-sachatte">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">1,000,000 Tibos</span>
            </button>
            
            <!-- NOUVELLE AM√âLIORATION : Milodes -->
            <button id="upgrade-passive-milodes" class="upgrade-button" data-base-cost="8000000" data-tps="10000" data-count="0" data-upgrade-key="milodes">
                <div class="upgrade-details">
                    <span class="upgrade-title">Milodes - Le Mobilisateur Instantan√© üöÄ</span>
                    <br><span class="upgrade-description">G√©n√®re 10,000 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-milodes">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">8,000,000 Tibos</span>
            </button>

            <!-- NOUVELLE AM√âLIORATION : Thomas -->
            <button id="upgrade-passive-thomas" class="upgrade-button" data-base-cost="50000000" data-tps="50000" data-count="0" data-upgrade-key="thomas">
                <div class="upgrade-details">
                    <span class="upgrade-title">Thomas - L'Architecte des Ressources üí∞</span>
                    <br><span class="upgrade-description">G√©n√®re 50,000 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-thomas">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">50,000,000 Tibos</span>
            </button>

            <!-- NOUVELLE AM√âLIORATION : Lenaik -->
            <button id="upgrade-passive-lenaik" class="upgrade-button" data-base-cost="200000000" data-tps="200000" data-count="0" data-upgrade-key="lenaik">
                <div class="upgrade-details">
                    <span class="upgrade-title">Lenaik - La Gardienne Hyper-Protectrice üõ°Ô∏è</span>
                    <br><span class="upgrade-description">G√©n√®re 200,000 Tibos/s</span>
                    <span class="upgrade-count" id="count-passive-lenaik">Poss√©d√©: 0</span>
                </div>
                <span class="upgrade-cost">200,000,000 Tibos</span>
            </button>

            
        </div>
        
    </div>

    <script>
        // JavaScript pour la logique du jeu
        let score = 0;
        let clickPower = 1; // Puissance de clic totale (base + bonus)
        let tps = 0; // Tibos Par Seconde
        let currentLang = 'fr'; // Langue par d√©faut
        const GAME_STORAGE_KEY = 'tiboClickerSave';
        const LANG_STORAGE_KEY = 'tiboClickerLang';
        const GROWTH_FACTOR = 1.15; // Facteur d'augmentation exponentiel
        const FORMAT_THRESHOLD = 100000; // Constante : 100 000 Tibos (100K)

        const scoreDisplay = document.getElementById('score');
        const tiboImage = document.getElementById('tibo-image');
        const clickPowerDisplay = document.getElementById('click-power-display');
        const tpsDisplay = document.getElementById('tps-display');
        
        // R√©f√©rences aux boutons pour la gestion de l'apparition
        const upgrade1 = document.getElementById('upgrade-click-1');
        const upgrade2_new = document.getElementById('upgrade-click-2-new'); 
        const upgrade3_new = document.getElementById('upgrade-click-3-new'); 
        
        // Liste de tous les boutons (incluant les cach√©s pour la v√©rification des co√ªts)
        const upgradeButtons = [
            upgrade1,
            upgrade2_new,
            upgrade3_new,
            document.getElementById('upgrade-addition'),
            document.getElementById('upgrade-passive-alessiode'),
            document.getElementById('upgrade-passive-justine'),
            document.getElementById('upgrade-passive-patate'),
            // Nouveaux Personnages
            document.getElementById('upgrade-passive-nogode'), 
            document.getElementById('upgrade-passive-sachatte'),
            document.getElementById('upgrade-passive-milodes'),
            document.getElementById('upgrade-passive-thomas'),
            document.getElementById('upgrade-passive-lenaik')
        ];
        
        // --- Dictionnaire de Traduction (Translations Dictionary) ---
        const translations = {
            fr: {
                // G√©n√©ral
                langLabel: "üåê", 
                mainTitle: "Tibo Clicker - La Vraie Transfo' ! üí™",
                musicLabel: "Musique", 
                tibosOwnedLabel: "Tibos Poss√©d√©s :",
                clickPowerDisplay: (power) => `Puissance de Clic : ${formatScore(power)} Tibo${power > 1 ? 's' : ''}`,
                tpsDisplay: (tps) => `Tibos par Seconde (TPS) : ${formatScore(tps)}`,
                upgradesTitle: "Am√©liorations",
                cost: (cost) => `${formatNumber(cost)} Tibos`, // Utilise formatNumber pour les co√ªts dans la liste
                purchased: (bonus) => `Achet√© ! (+${bonus} TPC)`,
                owned: (count) => `Poss√©d√©: ${count}`,
                
                // Upgrades Uniques
                mindset: { title: 'Mise en Place du "Mindset"', desc: 'Ajoute +1 TPC de base (Achat Unique)' },
                ultrasale: { title: 'Tibo Ultra Sale üí•', desc: 'Ajoute +3 TPC de base (Achat Unique)' },
                cheatmeal: { title: 'Le Cheat Meal Ultime üçï', desc: 'Ajoute +6 TPC de base (Achat Unique)' },
                
                // Upgrades Cumulables
                proteines: { title: 'D√©verrouillage des Prot√©ines', desc: 'Ajoute +5 Tibos par Clic' },
                alessio: { title: 'Alessiode - Coach Personnel üèãÔ∏è', desc: 'G√©n√®re 1 Tibo/s' },
                justine: { title: 'Justine - Community Manager üì∏', desc: 'G√©n√®re 10 Tibos/s' },
                // Patate Douce (CHEATEE)
                patates: { title: "L'Usine √† Patates Douces COSMIQUE üç†üöÄ", desc: 'G√©n√®re 150 Tibos/s' },
                // Nouveaux Personnages
                nogode: { title: 'Nogode - Le Disrupteur Sombre üñ§', desc: 'G√©n√®re 500 Tibos/s' },
                sachatte: { title: "Sachatte - L'√âclaireuse Mystique ‚ú®", desc: 'G√©n√®re 2,000 Tibos/s' },
                milodes: { title: 'Milodes - Le Mobilisateur Instantan√© üöÄ', desc: 'G√©n√®re 10,000 Tibos/s' },
                thomas: { title: 'Thomas - L\'Architecte des Ressources üí∞', desc: 'G√©n√®re 50,000 Tibos/s' },
                lenaik: { title: 'Lenaik - La Gardienne Hyper-Protectrice üõ°Ô∏è', desc: 'G√©n√®re 200,000 Tibos/s' },
            },
            en: {
                // General
                langLabel: "üåê",
                mainTitle: "Tibo Clicker - The Real Transformation! üí™",
                musicLabel: "Music",
                tibosOwnedLabel: "Tibos Owned :",
                clickPowerDisplay: (power) => `Click Power : ${formatScore(power)} Tibo${power > 1 ? 's' : ''}`,
                tpsDisplay: (tps) => `Tibos Per Second (TPS) : ${formatScore(tps)}`,
                upgradesTitle: "Upgrades",
                cost: (cost) => `${formatNumber(cost)} Tibos`,
                purchased: (bonus) => `Purchased! (+${bonus} CPC)`,
                owned: (count) => `Owned: ${count}`,
                
                // Unique Upgrades
                mindset: { title: 'Establishing the "Mindset"', desc: 'Adds +1 base CPC (Unique Purchase)' },
                ultrasale: { title: 'Ultra Dirty Tibo üí•', desc: 'Adds +3 base CPC (Unique Purchase)' },
                cheatmeal: { title: 'The Ultimate Cheat Meal üçï', desc: 'Adds +6 base CPC (Unique Purchase)' },
                
                // Cumulative Upgrades
                proteines: { title: 'Protein Unlock', desc: 'Adds +5 Tibos per Click' },
                alessio: { title: 'Alessiode - Personal Coach üèãÔ∏è', desc: 'Generates 1 Tibo/s' },
                justine: { title: 'Justine - Community Manager üì∏', desc: 'Generates 10 Tibos/s' },
                // Sweet Potato (CHEATED)
                patates: { title: 'The COSMIQUE Sweet Potato Factory üç†üöÄ', desc: 'Generates 150 Tibos/s' },
                // New Characters
                nogode: { title: 'Nogode - The Dark Disruptor üñ§', desc: 'Generates 500 Tibos/s' },
                sachatte: { title: 'Sachatte - The Mystic Scout ‚ú®', desc: 'Generates 2,000 Tibos/s' },
                milodes: { title: 'Milodes - The Instant Mobilizer üöÄ', desc: 'Generates 10,000 Tibos/s' },
                thomas: { title: 'Thomas - The Resource Architect üí∞', desc: 'Generates 50,000 Tibos/s' },
                lenaik: { title: 'Lenaik - The Hyper-Protective Guardian üõ°Ô∏è', desc: 'Generates 200,000 Tibos/s' },
            },
            es: {
                // General
                langLabel: "üåê",
                mainTitle: "Tibo Clicker - ¬°La Verdadera Transformaci√≥n! üí™",
                musicLabel: "M√∫sica",
                tibosOwnedLabel: "Tibos Pose√≠dos :",
                clickPowerDisplay: (power) => `Poder de Clic : ${formatScore(power)} Tibo${power > 1 ? 's' : ''}`,
                tpsDisplay: (tps) => `Tibos Por Segundo (TPS) : ${formatScore(tps)}`,
                upgradesTitle: "Mejoras",
                cost: (cost) => `${formatNumber(cost)} Tibos`,
                purchased: (bonus) => `¬°Comprado! (+${bonus} PPC)`,
                owned: (count) => `Pose√≠do: ${count}`,
                
                // Unique Upgrades
                mindset: { title: 'Establecer la "Mentalidad"', desc: 'A√±ade +1 PPC base (Compra √önica)' },
                ultrasale: { title: 'Tibo Ultra Sucio üí•', desc: 'A√±ade +3 PPC base (Compra √önica)' },
                cheatmeal: { title: 'La Comida Trampa Definitiva üçï', desc: 'A√±ade +6 PPC base (Compra √önica)' },
                
                // Cumulative Upgrades
                proteines: { title: 'Desbloqueo de Prote√≠nas', desc: 'A√±ade +5 Tibos por Clic' },
                alessio: { title: 'Alessiode - Entrenador Personal üèãÔ∏è', desc: 'Genera 1 Tibo/s' },
                justine: { title: 'Justine - Community Manager üì∏', desc: 'Genera 10 Tibos/s' },
                // Sweet Potato (CHEATED)
                patates: { title: 'La F√°brica de Batatas C√ìSMICA üç†üöÄ', desc: 'Genera 150 Tibo/s' },
                // New Characters
                nogode: { title: 'Nogode - El Disruptor Oscuro üñ§', desc: 'Genera 500 Tibo/s' },
                sachatte: { title: 'Sachatte - La Exploradora M√≠stica ‚ú®', desc: 'Genera 2,000 Tibo/s' },
                milodes: { title: 'Milodes - El Movilizador Instant√°neo üöÄ', desc: 'Genera 10,000 Tibo/s' },
                thomas: { title: 'Thomas - El Arquitecto de Recursos üí∞', desc: 'Genera 50,000 Tibo/s' },
                lenaik: { title: 'Lenaik - La Guardiana Hiperprotectora üõ°Ô∏è', desc: 'Genera 200,000 Tibo/s' },
            }
        };


        // --- Fonctions utilitaires ---
        
        // Calcul le prix exponentiel : prix de base * 1.15^n
        function calculateNewCost(baseCost, count) {
            return Math.ceil(baseCost * Math.pow(GROWTH_FACTOR, count));
        }
        
        /**
         * Formate un grand nombre en utilisant la notation abr√©g√©e (K, M, B, etc.)
         * si le nombre est sup√©rieur ou √©gal √† FORMAT_THRESHOLD (100K).
         */
        function formatScore(num) {
            // Si le nombre est inf√©rieur √† 100K, on affiche le nombre entier avec s√©parateur
            if (num < FORMAT_THRESHOLD) {
                return Math.floor(num).toLocaleString(currentLang === 'fr' ? 'fr-FR' : 'en-US');
            }
            
            // Logique de formatage K/M/B/T... pour les grands nombres
            const lookup = [
                { value: 1e18, symbol: "E" },
                { value: 1e15, symbol: "P" },
                { value: 1e12, symbol: "T" },
                { value: 1e9, symbol: "B" },
                { value: 1e6, symbol: "M" },
                { value: 1e3, symbol: "K" },
            ];
            
            // Trouve le bon suffixe. On commence la recherche √† partir de 1000 (K) m√™me si on sait
            // que l'entr√©e sera > 100K √† ce stade de la fonction.
            const item = lookup.find((item) => num >= item.value);
            
            if (item) {
                // Arrondi √† 2 d√©cimales pour l'affichage abr√©g√© (ex: 2.50M)
                const formatted = (num / item.value).toFixed(2);
                return formatted + item.symbol;
            }
            
            // Fallback pour les nombres vraiment immenses (non g√©r√©s par la lookup)
            return num.toExponential(2); 
        }

        /**
         * Formate un nombre pour les prix d'achat (utilise les s√©parateurs de milliers).
         * Ceci ne change pas et n'utilise pas la notation abr√©g√©e K/M/B.
         */
        function formatNumber(num) {
            return Math.floor(num).toLocaleString(currentLang === 'fr' ? 'fr-FR' : 'en-US'); 
        }

        // --- Logique de Traduction ---

        window.setLanguage = function(lang) {
            currentLang = lang;
            localStorage.setItem(LANG_STORAGE_KEY, lang);
            translateUI();
        }

        function translateUI() {
            const langData = translations[currentLang];
            if (!langData) return;

            // Traduction des √©l√©ments fixes
            document.getElementById('lang-label').textContent = langData.langLabel;
            document.getElementById('main-title').textContent = langData.mainTitle;
            document.getElementById('music-label').textContent = langData.musicLabel; 
            document.getElementById('tibos-owned-label').textContent = langData.tibosOwnedLabel;
            document.getElementById('upgrades-title').textContent = langData.upgradesTitle;

            // Traduction des scores et TPC/TPS
            document.getElementById('click-power-display').textContent = langData.clickPowerDisplay(clickPower);
            document.getElementById('tps-display').textContent = langData.tpsDisplay(tps);
            
            // Mise √† jour du score (avec le nouveau formatage)
            scoreDisplay.textContent = formatScore(score);

            // Traduction des Upgrades
            upgradeButtons.forEach(button => {
                const key = button.dataset.upgradeKey;
                if (!key) return;

                const upgradeData = langData[key];
                
                // Met √† jour le titre et la description
                button.querySelector('.upgrade-title').textContent = upgradeData.title;
                
                const descElement = button.querySelector('.upgrade-description');
                if (descElement) {
                    descElement.textContent = upgradeData.desc;
                }
                
                const costElement = button.querySelector('.upgrade-cost');
                
                // Gestion des upgrades achet√©s (Uniques)
                if (button.dataset.purchased === 'true') {
                    const bonus = button.dataset.addBonus || 0;
                    costElement.textContent = langData.purchased(bonus);
                    
                    const detailsElement = button.querySelector('.upgrade-details');
                    if (detailsElement) {
                        detailsElement.innerHTML = `<span class="upgrade-title">${upgradeData.title}</span><br>${langData.purchased(bonus)}`;
                    }

                } else {
                    // Upgrades actifs/cumulables
                    const currentCost = parseInt(button.dataset.cost) || parseInt(button.dataset.baseCost);
                    if (currentCost) {
                        costElement.textContent = langData.cost(currentCost);
                    } else if (button.dataset.addBonus) {
                        costElement.textContent = langData.cost(button.dataset.cost);
                    }
                }
                
                // Mise √† jour du compteur (Poss√©d√©/Owned/Pose√≠do) pour les upgrades cumulables
                const countElement = button.querySelector('.upgrade-count');
                if (countElement && button.dataset.baseCost) {
                    countElement.textContent = langData.owned(button.dataset.count);
                }
            });
        }


        // --- Syst√®me de Sauvegarde/Chargement (mis √† jour pour la langue) ---
        
        function saveGame() {
            const saveObject = {
                score: score,
                clickPower: clickPower,
                tps: tps,
                upgrades: {}
            };

            upgradeButtons.forEach(button => {
                const id = button.id;
                // Sauvegarder l'√©tat des upgrades cumulables (count)
                if (button.dataset.baseCost) {
                    saveObject.upgrades[id] = { count: parseInt(button.dataset.count) };
                } 
                // Sauvegarder l'√©tat des upgrades uniques (purchased)
                else {
                    saveObject.upgrades[id] = { purchased: button.dataset.purchased === 'true' };
                }
            });

            localStorage.setItem(GAME_STORAGE_KEY, JSON.stringify(saveObject));
        }

        function loadGame() {
            const savedData = localStorage.getItem(GAME_STORAGE_KEY);
            const savedLang = localStorage.getItem(LANG_STORAGE_KEY);
            
            if (savedLang) {
                currentLang = savedLang;
                document.getElementById('language-selector').value = savedLang;
            }
            
            if (!savedData) return false;

            const saveObject = JSON.parse(savedData);
            
            score = saveObject.score || 0;
            clickPower = saveObject.clickPower || 1;
            tps = saveObject.tps || 0;

            // Restaurer l'√©tat des upgrades
            if (saveObject.upgrades) {
                upgradeButtons.forEach(button => {
                    const id = button.id;
                    const savedUpgrade = saveObject.upgrades[id];
                    
                    if (savedUpgrade) {
                        // Cumulable
                        if (button.dataset.baseCost) {
                            button.dataset.count = savedUpgrade.count || 0;
                        } 
                        // Unique
                        else {
                            button.dataset.purchased = savedUpgrade.purchased ? 'true' : 'false';
                            
                            // Si d√©j√† achet√©, on le masque
                            if (savedUpgrade.purchased) {
                                button.classList.add('hidden');
                            }
                        }
                    }
                });
            }
            return true;
        }

        // Sauvegarde automatique toutes les 2 secondes (2000ms)
        setInterval(saveGame, 2000); 

        // --- Fonctions de Mise √† Jour ---

        function updateScore(amount) {
            score += amount;
            updateDisplays(); // Met √† jour le score dans updateDisplays
            checkUpgrades();
        }

        function updateDisplays() {
            // Utilise formatScore pour le score total
            scoreDisplay.textContent = formatScore(score); 
            const langData = translations[currentLang];
            
            // Utilise formatScore pour TPC et TPS aussi
            clickPowerDisplay.textContent = langData.clickPowerDisplay(clickPower);
            tpsDisplay.textContent = langData.tpsDisplay(tps);
        }

        /**
         * V√©rifie l'√©tat de tous les boutons d'am√©lioration, met √† jour les co√ªts
         * et les compteurs d'objets poss√©d√©s.
         */
        function checkUpgrades() {
            const langData = translations[currentLang];
            
            upgradeButtons.forEach(button => {
                if (button.dataset.purchased === 'true') {
                    button.disabled = true;
                    return;
                }
                
                let currentCost;
                
                // --- Logique pour les upgrades cumulables (prix exponentiel) ---
                if (button.dataset.baseCost) {
                    const baseCost = parseInt(button.dataset.baseCost);
                    const count = parseInt(button.dataset.count);
                    currentCost = calculateNewCost(baseCost, count);
                    
                    // Met √† jour l'affichage du co√ªt et du count
                    button.dataset.cost = currentCost;
                    // Utilise formatNumber pour le co√ªt (non formatScore)
                    button.querySelector('.upgrade-cost').textContent = langData.cost(currentCost);
                    
                    // Mise √† jour de l'affichage du nombre d'unit√©s poss√©d√©es
                    const countElement = button.querySelector('.upgrade-count');
                    if (countElement) {
                         countElement.textContent = langData.owned(count);
                    }
                } else {
                    // Logique pour les upgrades uniques (prix fixe)
                    currentCost = parseInt(button.dataset.cost);
                    button.querySelector('.upgrade-cost').textContent = langData.cost(currentCost);
                }


                // --- Logique d'apparition/disparition pour les upgrades uniques cons√©cutives ---
                if (button.id === 'upgrade-click-2-new') {
                    // Appara√Æt apr√®s l'achat de upgrade-click-1
                    if (upgrade1.dataset.purchased === 'true' && button.dataset.purchased !== 'true') {
                        button.classList.remove('hidden');
                        button.classList.add('new-upgrade-animation');
                    } else {
                        button.classList.add('hidden');
                    }
                } else if (button.id === 'upgrade-click-3-new') {
                    // Appara√Æt apr√®s l'achat de upgrade-click-2-new
                    if (upgrade2_new.dataset.purchased === 'true' && button.dataset.purchased !== 'true') {
                        button.classList.remove('hidden');
                        button.classList.add('new-upgrade-animation');
                    } else {
                        button.classList.add('hidden');
                    }
                }

                // V√©rification standard de l'achat
                if (!button.classList.contains('hidden')) {
                    button.disabled = score < currentCost;
                } else {
                    button.disabled = true;
                }
            });
        }

        // --- Logique du Clic ---

        // √âcouteur de clic principal sur l'image
        tiboImage.addEventListener('click', () => {
            updateScore(clickPower);
            createFloatingText(clickPower);
            
            // Tente de jouer la musique au premier clic
            const music = document.getElementById('background-music');
            music.play().catch(error => {});
        });

        // Fonction pour l'effet de texte flottant
        function createFloatingText(amount) {
            // Utilise formatScore pour le texte flottant
            const text = document.createElement('div');
            text.textContent = `+${formatScore(amount)}`;
            text.classList.add('floating-text');
            
            // Positionne le texte au niveau du clic
            const rect = tiboImage.getBoundingClientRect();
            text.style.left = `${rect.left + rect.width / 2}px`;
            text.style.top = `${rect.top + rect.height / 2}px`;
            
            document.body.appendChild(text);

            // Supprime l'√©l√©ment apr√®s l'animation
            text.addEventListener('animationend', () => {
                text.remove();
            });
        }

        // --- Logique des Am√©liorations (Upgrades) ---

        upgradeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const cost = parseInt(button.dataset.cost);
                const langData = translations[currentLang];
                
                if (score >= cost) {
                    updateScore(-cost); // D√©duire le co√ªt
                    
                    // --- Upgrades Additifs Uniques (Bonus de Clic de Base) ---
                    if (button.dataset.addBonus) {
                        const bonus = parseInt(button.dataset.addBonus);
                        clickPower += bonus; 
                        button.dataset.purchased = 'true'; 
                        
                        // Animation et remplacement pour la cha√Æne d'upgrades
                        button.style.opacity = '0';
                        
                        setTimeout(() => {
                            button.classList.add('hidden');
                            checkUpgrades(); // R√©v√®le l'upgrade suivante si n√©cessaire
                            translateUI(); // Re-traduit pour les nouveaux boutons
                        }, 500); // 0.5s pour correspondre √† la transition CSS
                        
                        // Met √† jour le texte du bouton apr√®s l'achat
                        const detailsElement = button.querySelector('.upgrade-details');
                        if (detailsElement) {
                             const key = button.dataset.upgradeKey;
                             const title = langData[key].title;
                             detailsElement.innerHTML = `<span class="upgrade-title">${title}</span><br>${langData.purchased(bonus)}`;
                        }
                        button.querySelector('.upgrade-cost').textContent = langData.purchased(bonus);
                    } 
                    
                    // --- Upgrades Cumulables (Ajout ou TPS) ---
                    else {
                        let count = parseInt(button.dataset.count);
                        count++;
                        button.dataset.count = count; // Mettre √† jour la donn√©e interne
                        
                        if (button.dataset.addition) {
                            clickPower += parseInt(button.dataset.addition);
                        } else if (button.dataset.tps) {
                            tps += parseInt(button.dataset.tps);
                        }

                        // Mise √† jour imm√©diate de l'affichage du nombre d'unit√©s poss√©d√©es apr√®s l'achat
                        const countElement = button.querySelector('.upgrade-count');
                        if (countElement) {
                             countElement.textContent = langData.owned(count);
                        }
                        
                        // Le co√ªt est recalcul√© et mis √† jour via checkUpgrades()
                    }

                    updateDisplays();
                    checkUpgrades(); // V√©rifie les nouveaux co√ªts et l'√©tat des boutons
                }
            });
        });

        // --- Logique Passive (Intervalle de temps) ---

        setInterval(() => {
            if (tps > 0) {
                // On ajoute les TPS au score toutes les 1000ms (1 seconde)
                updateScore(tps); 
            }
        }, 1000);

        // --- Syst√®me Audio (Playlist) ---
        const audioPlayer = document.getElementById('background-music');
        const trackTitleDisplay = document.getElementById('current-track-title');

        const allTracks = [
            { src: 'Concerto-Glazunov.mp3', title: "Concerto de Glazunov" },
            { src: 'Ballade-Tomasi.mp3', title: "Ballade de Tomasi" },
            { src: 'Tableaux_de_Provences-Paule_Maurice.mp3', title: "Tableaux de Provence" }
        ];

        // Filtre les sources manquantes (#) mais conserve les sources qui semblent √™tre des noms de fichiers
        const playlist = allTracks.filter(track => track.src !== '#' && track.src !== '' ); 
        
        let currentTrackIndex = 0;
        let isPlaying = false;

        function loadTrack(index, autoPlay = false) {
            if (playlist.length === 0) {
                trackTitleDisplay.textContent = "Aucune musique disponible. Ajoutez vos sources MP3!";
                return;
            }

            // Assure que l'index est dans la boucle
            currentTrackIndex = index % playlist.length;
            if (currentTrackIndex < 0) {
                currentTrackIndex += playlist.length;
            }

            // D√©finition de la source
            audioPlayer.src = playlist[currentTrackIndex].src;
            audioPlayer.load();
            trackTitleDisplay.textContent = playlist[currentTrackIndex].title;
            
            if (autoPlay || isPlaying) {
                 audioPlayer.play().catch(error => {
                    console.log("La lecture audio a √©t√© bloqu√©e. Un clic sur Tibo ou le bouton de lecture est n√©cessaire.");
                    isPlaying = false;
                });
            }
        }

        window.toggleMusic = function() {
            if (playlist.length === 0) return;
            if (audioPlayer.paused) {
                audioPlayer.play().catch(error => {
                    console.log("Lecture audio impossible sans interaction utilisateur.");
                });
                isPlaying = true;
            } else {
                audioPlayer.pause();
                isPlaying = false;
            }
        }

        window.nextTrack = function() {
            if (playlist.length === 0) return;
            // Charge la piste suivante et tente de jouer si isPlaying est vrai
            loadTrack(currentTrackIndex + 1, isPlaying); 
        }

        // √âcouteur pour passer √† la piste suivante √† la fin de la piste actuelle
        audioPlayer.addEventListener('ended', () => {
            nextTrack();
        });


        // --- Initialisation du Jeu ---
        function initializeGame() {
            // Tente de charger la partie et la langue
            loadGame();

            // Applique la traduction initiale
            translateUI();

            // S'assure que l'affichage est √† jour apr√®s le chargement ou l'initialisation
            updateDisplays(); 
            checkUpgrades(); 
            
            // Initialise le syst√®me de musique
            if (playlist.length > 0) {
                loadTrack(currentTrackIndex);
            }
        }

        // Lancement de l'initialisation
        initializeGame();
    </script>

</body>
</html>
